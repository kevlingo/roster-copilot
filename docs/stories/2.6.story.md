# Story 2.6: AI-Powered Archetype Discovery

## Status: Approved

## Epic: 2 - AI Copilot Onboarding & Personalization Foundation MVP

## Story

- As a new user undergoing AI Copilot onboarding, I want Jake to discover my Fantasy Manager Archetype through natural conversation and personality adaptation rather than presenting me with a list to choose from, so that the archetype selection feels like a natural realization rather than a quiz.

## Dependencies

- **Prerequisite:** Story 2.5 (Gemini API Conversational Intelligence Foundation) must be completed
- **Replaces:** Current archetype presentation and selection logic from Story 2.1
- **Foundation for:** Story 2.7 (Enhanced Conversational Questionnaire)

## Acceptance Criteria (ACs)

1. **Natural Archetype Discovery**: Jake discovers the user's archetype through conversation rather than presenting a list:
   - Engages in natural dialogue about fantasy football approach and preferences
   - Asks follow-up questions based on user responses and apparent expertise level
   - Suggests archetype based on conversation patterns and user responses
   - Makes the archetype suggestion feel like a natural realization

2. **Personality-Driven Conversations**: Jake adapts his conversation style based on user personality cues:
   - **Enthusiastic New Users**: Gets excited, encouraging, uses beginner-friendly language
   - **Analytical Users**: Bonds over data and strategy, uses analytical terminology
   - **Experienced Users**: Acknowledges expertise, engages in advanced strategy discussion
   - **Uncertain Users**: Provides gentle guidance and clarifying questions

3. **Dynamic Archetype Suggestion**: The system intelligently suggests archetypes based on conversation analysis:
   - **Eager Learner**: Users who ask questions, want explanations, mention being new
   - **Calculated Strategist**: Users who mention data, analysis, research, statistics
   - **Bold Playmaker**: Users who mention risks, bold moves, championship focus
   - **Busy Optimizer**: Users who mention time constraints, efficiency, quick decisions

4. **Conversational Confirmation**: Archetype confirmation feels natural and enthusiastic:
   - Jake explains why the suggested archetype fits the user
   - Celebrates the user's style and approach
   - Builds excitement about the partnership
   - Allows natural conversation if user wants to explore other options

5. **Flexible Conversation Paths**: Multiple conversation routes lead to successful archetype discovery:
   - Direct style descriptions from users
   - Indirect preference expressions
   - Questions about fantasy football approach
   - Stories about past fantasy experiences
   - Uncertainty that leads to guided discovery

6. **Conversation Memory & Building**: Jake builds on previous parts of the conversation:
   - References earlier user statements naturally
   - Connects user responses to archetype characteristics
   - Shows he's been listening and understanding
   - Creates conversational continuity and flow

7. **Archetype Persistence**: Selected archetype is saved with proper validation:
   - API call to `PUT /api/users/me` with selected archetype
   - Proper error handling for API failures
   - Confirmation of successful save
   - Graceful retry logic if needed

8. **Transition Logic**: Smooth transition to next onboarding steps:
   - **Eager Learner**: Natural transition to questionnaire (Story 2.7)
   - **Other Archetypes**: Enthusiastic completion and dashboard transition
   - Clear next steps communicated naturally in conversation

## Tasks / Subtasks

- [ ] **Task 1: Conversation Discovery Engine**
  - [ ] Implement natural archetype discovery through conversation analysis
  - [ ] Create conversation patterns for each archetype identification
  - [ ] Add follow-up question generation based on user responses
  - [ ] Implement uncertainty handling and guided discovery

- [ ] **Task 2: Personality Adaptation System**
  - [ ] Create user personality detection from conversation cues
  - [ ] Implement Jake's adaptive response generation for different user types
  - [ ] Add enthusiasm matching and energy level adaptation
  - [ ] Create expertise level recognition and appropriate responses

- [ ] **Task 3: Archetype Intelligence**
  - [ ] Replace static archetype presentation with dynamic suggestion
  - [ ] Implement conversation analysis for archetype pattern recognition
  - [ ] Create natural archetype suggestion and explanation logic
  - [ ] Add archetype confirmation and celebration responses

- [ ] **Task 4: Conversational Memory System**
  - [ ] Implement conversation history analysis and reference generation
  - [ ] Create natural conversation building and continuity
  - [ ] Add user statement tracking and callback functionality
  - [ ] Implement conversational flow intelligence

- [ ] **Task 5: Flexible Conversation Routing**
  - [ ] Create multiple conversation paths for archetype discovery
  - [ ] Implement conversation branch handling for different user approaches
  - [ ] Add conversation repair for unclear or mixed responses
  - [ ] Create natural conversation tangent handling

- [ ] **Task 6: Enhanced API Integration**
  - [ ] Update archetype persistence with new conversation-driven selection
  - [ ] Implement proper validation for AI-suggested archetypes
  - [ ] Add conversation context to API calls for better error handling
  - [ ] Create archetype confirmation and retry logic

- [ ] **Task 7: Transition Flow Management**
  - [ ] Implement intelligent transition logic based on selected archetype
  - [ ] Create natural conversation endings and next step communication
  - [ ] Add seamless flow to questionnaire for Eager Learners
  - [ ] Implement completion flow for other archetypes

- [ ] **Task 8: Testing & Validation**
  - [ ] Test archetype discovery accuracy across different conversation styles
  - [ ] Validate personality adaptation and response appropriateness
  - [ ] Test conversation memory and building functionality
  - [ ] Verify API integration and archetype persistence

- [ ] **Task 9: Build and Test Validation**
  - [ ] Build completed successfully with no errors
  - [ ] All tests passing including new archetype discovery tests
  - [ ] Integration working properly with Gemini API foundation

- [ ] **Task 10: Story Completion**
  - [ ] All acceptance criteria met and validated
  - [ ] AI-powered archetype discovery fully functional
  - [ ] Ready for Story 2.7 (Enhanced Conversational Questionnaire)
  - [ ] Story marked as Complete following BMAD methodology

## Dev Technical Guidance

- **Conversation Analysis (Advanced AI Techniques 2025):**
  - Leverage Gemini 2.5 Pro's adaptive thinking capabilities for complex archetype pattern recognition
  - Implement hybrid short-term memory (6-8 message history) with user profiling
  - Use environmental sensing to adjust responses based on user context and device type
  - Deploy automated testing with 500+ conversation variations for pattern validation
  - Reference: [Conversational AI Context Management](https://ai.google.dev/gemini-api/docs/thinking)

- **Personality Adaptation:**
  - Implement dynamic response generation based on user personality cues
  - Create enthusiasm and energy level matching algorithms
  - Use conversation style adaptation (formal vs casual, technical vs simple)
  - Implement expertise acknowledgment and appropriate response complexity

- **Archetype Intelligence:**
  - Create conversation pattern recognition for each archetype
  - Implement confidence scoring for archetype suggestions
  - Add natural suggestion timing and conversation flow
  - Create archetype explanation and celebration responses

- **Conversation Memory:**
  - Implement conversation history analysis and reference generation
  - Create natural callback and building functionality
  - Use conversation context for improved response relevance
  - Maintain conversation continuity across multiple exchanges

- **API Integration (Next.js TypeScript Best Practices):**
  - Extend existing `PUT /api/users/me` endpoint with conversation context validation
  - Implement rate limiting middleware with proper 429 responses and Retry-After headers
  - Use TypeScript interfaces for archetype validation and error response types
  - Create seamless integration with existing user profile system using type-safe API calls
  - Reference: [Next.js API Routes TypeScript](https://nextjs.org/docs/api-routes/introduction)

- **Architecture References:**
  - Existing Archetype Definitions: `docs/stories/2.1.story.md` (completed archetype system)
  - API Endpoints: `docs/api-reference.md#user-profile-endpoints`
  - Data Models: `docs/data-models.md#user-archetype-schema`
  - Frontend State Management: `docs/front-end-state-management.md#AI-conversation-patterns`

## Story Progress Notes

### Agent Model Used: `<Agent Model Name/Version>`

### Completion Notes List

{Implementation notes will be added during development}

### Change Log

| Change                    | Date       | Version | Description                                    | Author        |
| ------------------------- | ---------- | ------- | ---------------------------------------------- | ------------- |
| Initial Story Creation    | 2025-06-06 | 1.0     | Created AI-powered archetype discovery story  | Jack (PM)     |
| References Updated        | 2025-06-06 | 1.1     | Enhanced with latest 2025 best practices      | Bob (SM)      |
| Status Approved           | 2025-06-06 | 1.2     | Story validated and approved for development   | Bob (SM)      |
