# Story 1.12: Display of Fantasy Scores

## Status: Approved

## Epic: 1 - Core Platform Foundation & League Engagement MVP

## Story

- As a logged-in user, I want to be able to view fantasy scores for NFL games (from the PoC static dataset) so that I can track player performances and my team's matchup.

## Acceptance Criteria (ACs)

1.  The application can access and display NFL game information and player fantasy scores derived from the static PoC dataset (`NFLGame` for game details/outcomes, `NFLPlayer` for `projectedPoints` or simulated actual scores for a given week).
2.  Users can view a summary of real NFL game scores for the current/past PoC week's games relevant to their league. This could be a "Scoreboard" component on the League Home/Dashboard (`app/(main)/dashboard/page.tsx`) or a dedicated "Scores" page (e.g., `app/(main)/league/[leagueId]/scores/page.tsx`).
3.  For each real NFL game displayed, users see participating teams (`NFLGame.homeTeamAbbreviation`, `NFLGame.awayTeamAbbreviation`), their real scores (`NFLGame.homeScore`, `NFLGame.awayScore`), and game status (`NFLGame.gameStatus`).
4.  Within a user's weekly fantasy matchup view (UI component/page, potentially `app/(main)/league/[leagueId]/matchup/page.tsx` or part of the dashboard):
    * The fantasy points for each player in their starting lineup are displayed.
    * The fantasy points for each player in their opponent's starting lineup are displayed.
    * Total fantasy scores for both the user's team and opponent's team for the week are displayed.
    * These points are based on `NFLPlayer.projectedPoints` (or simulated actual scores if that field evolves) from the static PoC dataset for the relevant `League_PoC.currentSeasonWeek`.
5.  For PoC, displaying a single, static set of points for the week (based on `projectedPoints`) is acceptable. Simulating live scoring updates is out of scope for MVP.
6.  The UI clearly indicates that displayed scores are based on PoC static/projected data.

## Tasks / Subtasks

- [ ] **Task 1: Backend - API Endpoint for Weekly Scores & Matchups (`GET /api/leagues/[leagueId]/matchups?week=[weekNumber]`)**
    - [ ] Create API Route Handler.
    - [ ] Endpoint should be protected and use `leagueId`, `weekNumber`, and authenticated `userId`.
    - [ ] Logic to determine the user's fantasy matchup for the given week (who their opponent `FantasyTeam_PoC` is). This might require a predefined league schedule logic.
    - [ ] Retrieve relevant `NFLGame` data for all NFL games in the specified week.
    - [ ] Retrieve lineup data (starters) for both the user's team and their opponent's team for that week (from Story 1.10 data).
    - [ ] For every player in both starting lineups, fetch their `NFLPlayer` data (especially `projectedPoints` or simulated actual scores for that week).
    - [ ] Calculate total fantasy scores for both teams in the matchup.
    - [ ] Return data structure including: list of all NFL games with their scores/status, and specific matchup details (user's team, opponent's team, players in each lineup with their fantasy scores, total team scores).
    - [ ] Apply core API middleware.
- [ ] **Task 2: Frontend - "NFL Scoreboard" UI Component**
    - [ ] **Subtask 2.1:** Prompt v0.io (or similar) to generate a UI component that displays a list of NFL games for a week, showing home team, away team, scores, and game status.
    - [ ] **Subtask 2.2:** Review, adapt generated code, ensure adherence to `Frontend-Architecture.md`.
    - [ ] **Subtask 2.3:** Integrate this component into the League Dashboard (`app/(main)/dashboard/page.tsx`) or a dedicated Scores page, populating it with data from the backend API.
- [ ] **Task 3: Frontend - "Fantasy Matchup" UI Component**
    - [ ] **Subtask 3.1:** Prompt v0.io (or similar) to generate a UI component that displays a head-to-head fantasy matchup. It should show two fantasy teams, lists of their starting players with individual fantasy scores, and total team fantasy scores.
    - [ ] **Subtask 3.2:** Review, adapt generated code, ensure adherence to `Frontend-Architecture.md`.
    - [ ] **Subtask 3.3:** Integrate this component (e.g., on the League Dashboard or a dedicated Matchup page `app/(main)/league/[leagueId]/matchup/page.tsx`), populating it with data from the backend API for the user's current weekly matchup.
- [ ] **Task 4: Frontend - Page Integration and Data Fetching**
    - [ ] Implement logic on relevant pages (Dashboard, Scores, Matchup) to fetch data from the `/api/leagues/[leagueId]/matchups` endpoint.
    - [ ] Pass data to the Scoreboard and Fantasy Matchup components.
    - [ ] Handle loading states and errors.
- [ ] **Task 5: Testing**
    - [ ] Unit tests for backend logic (determining matchups, calculating fantasy scores from player data).
    - [ ] Unit tests for frontend Scoreboard and Fantasy Matchup components (display logic).
    - [ ] Integration test for the `matchups` API endpoint.
    - [ ] E2E test for viewing the NFL scoreboard and the user's fantasy matchup with correct player scores and team totals displayed.

## Dev Technical Guidance

- **Backend:**
    - Refer to `Architecture.md` for `NFLGame`, `NFLPlayer`, `FantasyTeam_PoC`, and `League_PoC` data models.
    - Logic to determine weekly fantasy matchups for each team in the league will be needed (e.g., based on a pre-defined schedule algorithm or static schedule data for the PoC).
    - Aggregating player fantasy scores (`projectedPoints`) for each team in a matchup is a key function.
- **Frontend:**
    - The v0.io prompts for the Scoreboard and Fantasy Matchup UIs should describe clear, tabular, or card-based layouts for presenting scores.
    - Ensure player details within the matchup view are consistent with how they appear elsewhere (e.g., using a variant of `DraftPlayerCard.tsx` or similar).
    - Clearly label that scores are "Projected" or "PoC Data."
- **Data:** Static `NFLGame` data needs `homeScore`, `awayScore`, and `gameStatus`. `NFLPlayer` data needs `projectedPoints` for players relevant to the scheduled games.

## Story Progress Notes

### Agent Model Used: `<To be filled by Dev Agent>`

### Completion Notes List

{To be filled by Dev Agent}

### Change Log

| Change                                    | Date       | Version | Description                                     | Author     |
| :---------------------------------------- | :--------- | :------ | :---------------------------------------------- | :--------- |
| Formalized by PO                          | 2025-05-31 | 0.1     | Initial formalization                           | Sarah (PO) |
| Prepared for Dev by SM                    | 2025-06-01 | 1.0     | Added detailed tasks, v0.io step, tech guidance | Bob (SM)   |