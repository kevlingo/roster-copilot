# Story 4.1: Generate Personalized Weekly Strategy Digest

## Status: Approved

## Epic: 4 - AI-Driven In-Season Strategic Guidance MVP (Roster Copilot)

## Story

- As an active **Roster Copilot** user, I want to receive a personalized "Weekly Strategy Digest" from the AI Copilot so that I can get timely advice on waiver targets and start/sit decisions tailored to my team and preferences.

## Acceptance Criteria (ACs)

1.  The system generates a "Personalized Weekly Strategy Digest" for each user. For PoC, this generation can be triggered manually by the user (e.g., via a button in the AI Copilot Panel or on the `/copilot/digest` page) or on a simple schedule (e.g., once when `League_PoC.currentSeasonWeek` advances), using the static dataset's current week.
2.  The digest includes AI Copilot-identified top waiver wire targets based on:
    * User's team needs (`FantasyTeam_PoC.playerIds_onRoster`, `League_PoC.rosterSettings`).
    * User's `UserProfile` preferences (`riskComfortLevel`, `learnedObservations`, etc.).
    * Available `NFLPlayer` static data (unowned players in the league).
3.  The digest includes AI Copilot-recommended start/sit options for key lineup decisions for the upcoming `League_PoC.currentSeasonWeek`, considering:
    * Player matchups (from static `NFLGame` data).
    * User's `UserProfile` preferences.
    * User's current roster and set lineup (from Story 1.10).
4.  Each piece of advice (waiver target, start/sit option) is presented with a concise, preference-driven explanation (leveraging logic from Story 4.5: "Preference-Driven Explanation Style").
5.  The digest may also include brief highlights of important strategic considerations or matchup advantages/disadvantages for the upcoming week, based on static PoC data.
6.  The digest is accessible via:
    * A notification and summary in the AI Copilot Panel (e.g., using `DigestSummaryItem.tsx` as per v0.io prompt Story 5).
    * A link on the main dashboard (`app/(main)/dashboard/page.tsx`).
    * A dedicated "Weekly Strategy Digest Screen" (`app/(main)/copilot/digest/page.tsx` - path updated for Roster Copilot).
7.  Content is generated by the "AI Copilot Service" using static PoC datasets.
8.  The digest is presented in a clear, scannable, and engaging format (e.g., "Insight Cards" as per `UIUX_Spec.md`).

## Tasks / Subtasks

- [ ] **Task 1: Backend ("AI Copilot Service") - Digest Content Generation Logic**
    - [ ] **Subtask 1.1:** Design PoC logic for identifying top waiver targets (e.g., highest `projectedPoints` among available players for positions of need, filtered by basic `UserProfile` preferences like avoiding players from `teamsToAvoidPlayersFrom`).
    - [ ] **Subtask 1.2:** Design PoC logic for recommending start/sit options (e.g., comparing `projectedPoints` of players on roster for a position, considering `NFLPlayer.status` and simple matchup factors from `NFLGame.matchupContextNotes`).
    - [ ] **Subtask 1.3:** Design PoC logic for generating brief strategic highlights.
    - [ ] **Subtask 1.4:** Implement functions in "AI Copilot Service" to generate these content pieces, incorporating preference-driven explanation styles (from Story 4.5 logic).
- [ ] **Task 2: Backend - API Endpoint for Weekly Digest (`GET /api/copilot/weekly-digest`)**
    - [ ] Create API Route Handler (e.g., `app/api/copilot/weekly-digest/route.ts`).
    - [ ] Endpoint must be protected, requiring an authenticated user.
    - [ ] Input: `userId` (from session), `leagueId` (if applicable, or derives from user's primary league), `weekNumber` (`League_PoC.currentSeasonWeek`).
    - [ ] Call the "AI Copilot Service" to generate the digest content.
    - [ ] Return the structured digest content (waiver targets, start/sit advice, highlights, explanations).
    - [ ] Apply core API middleware.
- [ ] **Task 3: Frontend - "Weekly Strategy Digest" Page/View UI & Logic (`app/(main)/copilot/digest/page.tsx`)**
    - [ ] **Subtask 3.1:** Use the v0.io prompt (section related to `/mentor/digest` - now `/copilot/digest` - page: "Key Elements: Sections for waiver targets, start/sit advice... Likely presented using 'Insight Cards.'") to generate the initial UI structure.
    - [ ] **Subtask 3.2:** Review and adapt generated code. Ensure adherence to `Frontend-Architecture.md`.
    - [ ] **Subtask 3.3:** Implement UI elements (e.g., "Insight Cards") to display waiver targets, start/sit advice, explanations, and strategic highlights fetched from the API.
    - [ ] **Subtask 3.4:** Handle API call to fetch digest content.
    - [ ] **Subtask 3.5:** Ensure clear presentation and scannability.
- [ ] **Task 4: Frontend - Digest Summary in AI Copilot Panel**
    - [ ] **Subtask 4.1:** Design and implement a summary view of the latest digest for the AI Copilot Panel (`AIPanel.tsx`).
    - [ ] **Subtask 4.2:** This might use a component like `DigestSummaryItem.tsx` (from v0.io prompt Story 5) to list key insights with a link to the full digest page.
    - [ ] **Subtask 4.3:** Fetch or receive digest summary data when the panel loads or updates.
- [ ] **Task 5: Testing**
    - [ ] Unit tests for backend digest generation logic (waiver selection, start/sit recommendations based on PoC rules).
    - [ ] Unit tests for frontend components displaying digest content.
    - [ ] Integration test for the `/api/copilot/weekly-digest` API endpoint.
    - [ ] E2E test: User navigates to view their Weekly Strategy Digest (either full page or panel summary), verifies personalized advice is displayed with explanations.

## Dev Technical Guidance

- **Backend ("AI Copilot Service"):**
    - Refer to `Architecture.md` for `UserProfile`, `NFLPlayer`, `NFLGame`, `FantasyTeam_PoC`, `League_PoC` data models.
    - PoC logic for recommendations will be rule-based and heuristic-driven, using the static data.
    - If using Gemini for parts of the content/explanation generation, prompts must be carefully crafted with relevant context (user profile, team data, player data).
- **Frontend:**
    - Leverage the v0.io prompt for the initial UI of the digest page and summary items.
    - The "Insight Card" concept from `UIUX_Spec.md` should guide the visual presentation of digest items.
    - Ensure links from summaries (e.g., in AI Copilot Panel) to the full digest page function correctly.
- **Data:** The quality and structure of `NFLPlayer` (projected points, status, key attributes) and `NFLGame` (matchup context) static data are crucial for generating meaningful digest content for PoC.

## Story Progress Notes

### Agent Model Used: `<To be filled by Dev Agent>`

### Completion Notes List

{To be filled by Dev Agent}

### Change Log

| Change                                    | Date       | Version | Description                                                    | Author     |
| :---------------------------------------- | :--------- | :------ | :------------------------------------------------------------- | :--------- |
| Formalized by PO (as Roster Mentor)       | 2025-05-31 | 0.1     | Initial formalization                                          | Sarah (PO) |
| Prepared for Dev by SM (Updated to Roster Copilot) | 2025-06-01 | 1.0     | Added detailed tasks, v0.io step, tech guidance, project name | Bob (SM)   |