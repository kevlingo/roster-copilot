# Story 1.6: Basic League Creation

## Status: Approved

## Epic: 1 - Core Platform Foundation & League Engagement MVP

## Story

- As a registered and logged-in user, I want to be able to create a new fantasy football league with basic settings so that I can start a league and invite others to join.

## Acceptance Criteria (ACs)

1.  A logged-in user can access a "Create League" option/page (e.g., from their main dashboard `app/(main)/dashboard/page.tsx` or a league selection page, as per `UIUX_Spec.md`). This page might be `app/(main)/league/create/page.tsx`.
2.  The "Create League" form requires the user to input a unique League Name.
3.  The "Create League" form allows the user to select the number of teams in the league (options: 8, 10, 12, as per `Architecture.md` Data Models `League_PoC.numberOfTeams`).
4.  The "Create League" form allows the user to select a basic scoring type ("Standard," "PPR," as per `Architecture.md` Data Models `League_PoC.scoringType`).
5.  Upon submission of valid league creation details:
    * A new `League_PoC` record is created in the system.
    * The submitting user is assigned as the `commissionerUserId` for the league.
    * The league has a default `draftStatus` of "Scheduled".
    * The `currentSeasonWeek` is set to an initial value (e.g., 1).
    * Default `rosterSettings` are applied (e.g., { QB: 1; RB: 2; WR: 2; TE: 1; K: 1; DEF: 1; BENCH: 6 } or as per a defined PoC default in `Architecture.md`).
6.  After successful league creation, the user (Commissioner) is redirected to the newly created league's dashboard/home page (e.g., `/league/[leagueId]/dashboard` or a similar league-specific view).
7.  The system displays a success message upon league creation.
8.  If league creation fails (e.g., non-unique league name if enforced globally, or other validation errors), a clear error message is displayed to the user.
9.  Other league settings (e.g., specific waiver rules, detailed playoff settings) use predefined PoC defaults and are not customizable at this stage.

## Tasks / Subtasks

- [ ] **Task 1: Backend - Create League API Endpoint (`POST /api/leagues`)**
    - [ ] Create API Route Handler at `app/api/leagues/route.ts` (or similar for POST).
    - [ ] Implement input DTO validation (leagueName, numberOfTeams, scoringType).
    - [ ] Implement logic to ensure league name uniqueness if required by system design (PoC might allow non-unique names for simplicity unless specified otherwise).
    - [ ] Generate a unique `leagueId`.
    - [ ] Create `League_PoC` record in the database, populating `commissionerUserId` with the authenticated user's ID, and setting defaults for `draftStatus`, `currentSeasonWeek`, and `rosterSettings`.
    - [ ] Return the newly created league object (or at least its ID).
    - [ ] Apply core API middleware (error handling, logging).
- [ ] **Task 2: Frontend - "Create League" Page UI & Logic (e.g., `app/(main)/league/create/page.tsx`)**
    - [ ] **Subtask 2.1:** Use v0.io (or similar, by prompting it for a simple form page) to generate the initial UI structure for a page with input fields for League Name (text), Number of Teams (select dropdown: 8, 10, 12), and Scoring Type (select dropdown: Standard, PPR), and a "Create League" button.
    - [ ] **Subtask 2.2:** Review and adapt generated code. Ensure adherence to `Frontend-Architecture.md`.
    - [ ] **Subtask 2.3:** Implement client-side form state management and validation.
    - [ ] **Subtask 2.4:** Handle API call to the "Create League" endpoint on form submission.
    - [ ] **Subtask 2.5:** On success, redirect the user to the new league's dashboard (e.g., `/league/[newLeagueId]/dashboard`).
    - [ ] **Subtask 2.6:** Display success or error messages from the API.
- [ ] **Task 3: Frontend - Link/Button to Create League**
    - [ ] Add a "Create League" button or link to an appropriate location (e.g., user dashboard `app/(main)/dashboard/page.tsx` or a league listing page) that navigates to the "Create League" page.
- [ ] **Task 4: Testing**
    - [ ] Write unit tests for backend league creation logic and validation.
    - [ ] Write unit tests for the frontend "Create League" form component.
    - [ ] Write an integration test for the "Create League" API endpoint.
    - [ ] Write an E2E test for the complete league creation flow: navigating to the form, filling it out, submitting, and being redirected to the new league's page.

## Dev Technical Guidance

- **Backend:**
    - Refer to `Architecture.md` for the `League_PoC` data model. Ensure all fields (`leagueId`, `leagueName`, `commissionerUserId`, `numberOfTeams`, `scoringType`, `draftStatus`, `currentSeasonWeek`, `participatingTeamIds` (initially empty or just commissioner's team if auto-created), `rosterSettings`) are correctly populated or defaulted.
    - `leagueId` should be unique (e.g., UUID).
- **Frontend:**
    - The v0.io prompt for the "Create League" form should be straightforward. The Developer Agent will need to integrate the generated UI with form handling logic and API calls.
    - Ensure select dropdowns for "Number of Teams" and "Scoring Type" are populated with the allowed options from `Architecture.md`.
- **General:**
    - API endpoint needs core middleware.

## Story Progress Notes

### Agent Model Used: `<To be filled by Dev Agent>`

### Completion Notes List

{To be filled by Dev Agent}

### Change Log

| Change                                    | Date       | Version | Description                                     | Author     |
| :---------------------------------------- | :--------- | :------ | :---------------------------------------------- | :--------- |
| Formalized by PO                          | 2025-05-31 | 0.1     | Initial formalization                           | Sarah (PO) |
| Prepared for Dev by SM                    | 2025-06-01 | 1.0     | Added detailed tasks, v0.io step, tech guidance | Bob (SM)   |