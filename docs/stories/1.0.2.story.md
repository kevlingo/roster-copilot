# Story 1.0.2: Seed Static NFL Player and Game Data into SQLite Database

## Status: Approved

## Epic: 1 - Core Platform Foundation & League Engagement MVP

## Story

- As a Developer/System, I need to seed the SQLite database with data from the static `nfl-players.json` and `nfl-games.json` files so that the application has initial NFL player and game data to operate with for the PoC.

## Acceptance Criteria (ACs)

1.  A mechanism (e.g., a script located in `scripts/database/seed-db.ts`, a one-time setup function callable by a developer) exists to read `nfl-players.json` and `nfl-games.json` from their location (`data/static-nfl-data/`).
2.  Before seeding, the relevant tables (`NFLPlayers`, `NFLGames` â€“ or equivalent names as per final `Architecture.md` Data Models and DAL implementation) are created in the SQLite database (`data/roster_copilot_poc.db`) if they don't already exist. These table schemas MUST match the `NFLPlayer` and `NFLGame` interfaces defined in `Architecture.md`.
3.  All player objects from `nfl-players.json` are inserted into the `NFLPlayers` table.
4.  All game objects from `nfl-games.json` are inserted into the `NFLGames` table.
5.  The seeding process correctly handles data type conversions or mapping between JSON fields and database columns as necessary, according to the schemas in `Architecture.md`. For example, JSON arrays or objects (like `NFLPlayer.keyAttributes` or `NFLGame.matchupContextNotes`) might need to be stored as JSON strings in SQLite or handled according to DAL strategy.
6.  The seeding process is idempotent for the PoC (e.g., it first clears the existing data from the tables or uses `INSERT OR IGNORE`/`INSERT OR REPLACE` to prevent duplication or errors if run multiple times).
7.  A clear success message or log is produced upon completion of the seeding process (e.g., "Successfully seeded NFLPlayers and NFLGames tables.").
8.  If errors occur during seeding (e.g., JSON parsing error, database write error), they are logged clearly, and the process ideally stops or rolls back any partial seeding for that run to maintain data integrity.
9.  This seeding mechanism is intended for initial PoC data setup and can be run by a developer during project initialization or when the static data files are updated.

## Tasks / Subtasks

- [ ] **Task 1:** Design/Confirm SQLite Table Schemas
    - [ ] Based on `NFLPlayer` and `NFLGame` interfaces in `Architecture.md`, finalize the `CREATE TABLE` statements for `NFLPlayers` and `NFLGames` tables.
    - [ ] Pay special attention to how complex types (objects, arrays like `keyAttributes` or `matchupContextNotes`) will be stored (e.g., as JSON strings).
- [ ] **Task 2:** Develop Seeding Script (`scripts/database/seed-db.ts`)
    - [ ] Implement logic to connect to the SQLite database file (`data/roster_copilot_poc.db`).
    - [ ] Implement `CREATE TABLE IF NOT EXISTS` logic for `NFLPlayers` and `NFLGames` using the schemas from Task 1.
    - [ ] Implement logic to clear existing data from tables before seeding (to ensure idempotency for PoC).
    - [ ] Implement logic to read and parse `data/static-nfl-data/nfl-players.json`.
    - [ ] Implement logic to iterate through player objects and insert them into the `NFLPlayers` table, handling any necessary data transformations (e.g., stringifying JSON objects/arrays).
    - [ ] Implement logic to read and parse `data/static-nfl-data/nfl-games.json`.
    - [ ] Implement logic to iterate through game objects and insert them into the `NFLGames` table, handling data transformations.
    - [ ] Implement error handling and success/error logging.
- [ ] **Task 3:** Create `package.json` Script for Seeding
    - [ ] Add a script to `package.json` (e.g., `"db:seed": "ts-node ./scripts/database/seed-db.ts"`) to easily run the seeding process.
- [ ] **Task 4:** Test Seeding Script
    - [ ] Run the script against an empty/test database.
    - [ ] Verify tables are created correctly.
    - [ ] Verify data is inserted accurately (check counts and sample records).
    - [ ] Verify idempotency by running the script multiple times.
    - [ ] Verify error handling (e.g., by temporarily corrupting a JSON file).
- [ ] **Task 5:** Document Seeding Process
    - [ ] Add a brief note in `README.md` or a specific `docs/database-setup.md` on how to run the seed script.

## Dev Technical Guidance

- **Database & Location:** SQLite database file at `data/roster_copilot_poc.db` as specified in `Architecture.md`.
- **SQLite Library:** Use the `sqlite3` Node.js package (version ~5.1.7 or as specified in `Architecture.md` final tech stack) for database interactions in the script.
- **Data Models & Schemas:**
    - Adhere strictly to `NFLPlayer` and `NFLGame` interfaces from `Architecture.md` for interpreting the JSON and defining table columns.
    - **Storing Complex JSON Fields:** For fields like `NFLPlayer.keyAttributes` (object) or `NFLGame.matchupContextNotes` (array), the simplest approach for SQLite is to `JSON.stringify()` them before insertion into a `TEXT` column and `JSON.parse()` them upon retrieval in the Data Access Layer (DAL). The DAL (to be built in a later story) will handle this parsing. The seed script should focus on stringifying for storage.
- **Scripting Language:** Use Node.js with TypeScript for the script (`seed-db.ts`) to maintain consistency with the project stack. Use `ts-node` or compile to JS for execution.
- **Input Files:** The script must read from `data/static-nfl-data/nfl-players.json` and `data/static-nfl-data/nfl-games.json` (outputs of Story 1.0.1).
- **Idempotency:** For PoC, deleting all rows from the tables before inserting new data is a simple way to achieve idempotency. Alternatively, use `INSERT OR IGNORE` if primary keys are well-defined and you want to avoid re-inserting existing data (though for static seeding, a clean slate is often easier).
- **Error Handling:** The script should use `try-catch` blocks for file operations and database transactions. Log errors clearly to the console.

## Story Progress Notes

### Agent Model Used: `<To be filled by Dev Agent>`

### Completion Notes List

{To be filled by Dev Agent}

### Change Log

| Change                               | Date       | Version | Description              | Author     |
| :----------------------------------- | :--------- | :------ | :----------------------- | :--------- |
| Initial Preparation for Dev Agent    | 2025-06-01 | 1.0     | Tasks and guidance added | Bob (SM)   |