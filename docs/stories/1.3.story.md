# Story 1.3: User Logout

## Status: Approved

## Epic: 1 - Core Platform Foundation & League Engagement MVP

## Story

- As a logged-in user, I want to be able to log out of my Roster Copilot account so that I can securely end my session.

## Acceptance Criteria (ACs)

1.  A clear "Logout" option (e.g., button, link) is accessible to logged-in users within the application's main navigation (e.g., Header or Sidebar, as defined in `UIUX_Spec.md` and `Frontend-Architecture.md`).
2.  Clicking the "Logout" option initiates the logout process.
3.  The user's current session is terminated securely on the server-side. This might involve invalidating any server-side session record or, if using JWTs, ensuring they are treated as expired (e.g., via a denylist if immediate revocation is needed, though for PoC, relying on short-lived access tokens and client-side removal might be sufficient).
4.  Any client-side session identifiers (e.g., tokens in memory via Zustand store, `sessionStorage`) are cleared as per the token handling strategy in `Frontend-Architecture.md`.
5.  Upon successful logout, the user is redirected to a public page (e.g., the Login page (`/login`) or Homepage (`/`)).
6.  The user can no longer access authenticated-only areas of the application (e.g., `/dashboard`) without logging in again.
7.  The system provides feedback to the user confirming they have been logged out (e.g., a brief message on the redirection page or a toast notification).

## Tasks / Subtasks

- [ ] **Task 1: Backend - Logout API Endpoint (`/api/auth/logout`)**
    - [ ] Create API Route Handler at `app/api/auth/logout/route.ts`.
    - [ ] Implement logic to invalidate the session token if applicable on the server-side (e.g., adding JWT to a short-lived denylist, clearing a server-side session). For PoC, if using stateless JWTs, this might primarily be a client-side action, but the endpoint should still exist for a clean logout process and future enhancements.
    - [ ] Perform any other necessary server-side session cleanup.
    - [ ] Return a success response.
    - [ ] Apply core API middleware (error handling, logging from Story 1.0.3).
- [ ] **Task 2: Frontend - Implement Logout Functionality**
    - [ ] **Subtask 2.1:** Add a "Logout" button/link to the appropriate UI element (e.g., in the Header component `src/components/layout/Header.tsx` or a user profile dropdown). Ensure this element is styled according to DaisyUI/Tailwind.
    - [ ] **Subtask 2.2:** On click, call the `/api/auth/logout` endpoint.
    - [ ] **Subtask 2.3:** Regardless of API call success (as client-side cleanup is paramount), clear all client-side session information (token from Zustand store or other specified storage, current user data from state).
    - [ ] **Subtask 2.4:** Redirect the user to the login page (`/login`) or homepage (`/`).
    - [ ] **Subtask 2.5:** Display a brief logout confirmation message (e.g., as a toast notification).
- [ ] **Task 3: Testing**
    - [ ] Write unit tests for logout service/logic on the backend (if any server-side invalidation occurs).
    - [ ] Write unit tests for the frontend component/hook handling the logout action and state clearing.
    - [ ] Write an integration test for the logout API endpoint.
    - [ ] Write an E2E test for the user logout flow: user logs in, clicks logout, is redirected, and can no longer access protected routes.

## Dev Technical Guidance

- **Backend:** Refer to `Architecture.md` for the session management strategy (e.g., JWTs). If using stateless JWTs, server-side logout primarily means the client discards the token. However, having an endpoint can be useful for things like logging logout events or if a token denylist is ever implemented.
- **Frontend:**
    - The "Logout" button/link should be placed as per `UIUX_Spec.md` and the overall layout defined in `Frontend-Architecture.md`. The v0.io prompt might have scaffolded a Header or Sidebar where this could be integrated.
    - Clearing client-side session data thoroughly is critical. Ensure any state management stores holding user session info are reset.
    - Redirection after logout should be immediate.
- **General:**
    - The API endpoint must be protected by the core API middleware (error handling, logging) from Story 1.0.3.

## Story Progress Notes

### Agent Model Used: `<To be filled by Dev Agent>`

### Completion Notes List

{To be filled by Dev Agent}

### Change Log

| Change                                    | Date       | Version | Description                                     | Author     |
| :---------------------------------------- | :--------- | :------ | :---------------------------------------------- | :--------- |
| Formalized by PO                          | 2025-05-31 | 0.1     | Initial formalization                           | Sarah (PO) |
| Prepared for Dev by SM                    | 2025-06-01 | 1.0     | Added detailed tasks and tech guidance        | Bob (SM)   |