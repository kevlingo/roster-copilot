# Story 2.1: Core Conversational Fantasy Manager Archetype Selection

## Status: Approved

## Epic: 2 - AI Copilot Onboarding & Personalization Foundation MVP

## Story

- As a new user undergoing AI Copilot onboarding, I want to engage in a basic natural conversation with the AI Copilot to select my "Fantasy Manager Archetype" so that I can establish my initial profile through the chat interface.

## Acceptance Criteria (ACs)

1.  After initial account creation/login and email verification (Story 1.1), the user is directed to the onboarding page where the AI Copilot initiates a conversational onboarding flow through the existing chat interface.
2.  The AI Copilot introduces itself and explains the purpose of archetype selection in a friendly, conversational manner (e.g., "Hi! I'm your AI Copilot. To give you the best personalized advice, I'd like to understand your fantasy football style.").
3.  The AI Copilot presents the four predefined "Fantasy Manager Archetypes" ("Eager Learner," "Calculated Strategist," "Bold Playmaker," "Busy Optimizer") through conversational descriptions rather than visual cards, explaining each archetype's characteristics in an engaging way.
4.  The AI Copilot asks the user to select their preferred archetype through natural language interaction (e.g., "Which of these sounds most like you?" or "You can tell me the name or number of the archetype that resonates with you").
5.  The user can respond with the archetype name, number (1-4), or natural language indicating their choice (e.g., "I'm definitely an Eager Learner" or "Number 2 sounds like me").
6.  The AI Copilot confirms the selection and provides encouraging, personalized feedback about the chosen archetype (e.g., "Great choice! As an Eager Learner, I'll make sure to explain the 'why' behind my advice to help you grow your fantasy skills.").
7.  Upon confirmation, the selected archetype is persisted to the user's `UserProfile` via an API call to `PUT /api/users/me`.
8.  Upon successful persistence of the selection, the conversation proceeds to the next step:
    * If "Eager Learner" is selected, the conversation seamlessly continues to the guided questionnaire (Story 2.2).
    * If another archetype is selected, the onboarding concludes with next steps and navigation guidance.
9.  The conversational flow handles edge cases gracefully:
    * Unclear or ambiguous responses (asks for clarification)
    * Requests for more information about specific archetypes (provides detailed explanations)
    * User wanting to change their selection (allows re-selection)
    * Technical errors during API calls (provides friendly error handling)

## Tasks / Subtasks

- [ ] **Task 1: Backend - Profile Update Capability**
    - [ ] Verify `PUT /api/users/me` endpoint accepts `UserProfile.selectedArchetype` field updates
    - [ ] Ensure backend validation for archetype string values ("Eager Learner", "Calculated Strategist", "Bold Playmaker", "Busy Optimizer")

- [ ] **Task 2: Core Conversation Scripts**
    - [ ] Create AI greeting and archetype introduction scripts
    - [ ] Design conversational descriptions for all four archetypes
    - [ ] Define confirmation and feedback messages for selections

- [ ] **Task 3: Chat Integration Foundation**
    - [ ] Integrate archetype selection with existing `PersistentChatInterface.tsx`
    - [ ] Implement basic onboarding conversation state tracking
    - [ ] Add onboarding context detection and message routing

- [ ] **Task 4: Response Processing**
    - [ ] Implement natural language processing for archetype selection (names, numbers, descriptions)
    - [ ] Create response validation and confirmation logic
    - [ ] Handle unclear responses with clarification requests

- [ ] **Task 5: API Integration**
    - [ ] Connect chat interface to `PUT /api/users/me` for archetype persistence
    - [ ] Implement API call triggers on confirmed selection
    - [ ] Add basic error handling for API failures

- [ ] **Task 6: Conversation Flow Control**
    - [ ] Implement conversation completion detection
    - [ ] Create transition logic to next onboarding step (Story 2.2 for Eager Learner)
    - [ ] Handle conversation state management during selection process

- [ ] **Task 7: Basic Error Handling**
    - [ ] Add user-friendly error messages for technical issues
    - [ ] Implement retry logic for failed API calls
    - [ ] Create fallback responses for unrecognized inputs

- [ ] **Task 8: Testing**
    - [ ] Write unit tests for conversation flow logic and response processing
    - [ ] Write integration tests for `PUT /api/users/me` archetype updates
    - [ ] Write E2E test for complete archetype selection flow

- [ ] **Task 9: Build and Test Validation**
    - [ ] Build completed successfully with no errors
    - [ ] All tests passing
    - [ ] Component integration working properly

- [ ] **Task 10: Story Completion**
    - [ ] All acceptance criteria met and validated
    - [ ] Core conversational archetype selection functional
    - [ ] Story marked as Complete following BMAD methodology

## Dev Technical Guidance

- **Frontend:**
    - Leverage existing `PersistentChatInterface.tsx` component for basic conversational interactions
    - Implement simple conversation state tracking for archetype selection process
    - Use basic natural language processing (keyword matching) for user responses
    - Focus on core conversation flow without advanced features
- **Backend:**
    - Use existing `/api/users/me` endpoint for `selectedArchetype` field updates
    - Basic error handling for API failures
- **Data Models:** Refer to `Architecture.md` for `UserProfile.selectedArchetype` field
- **Conversation Design:**
    - Keep scripts simple, friendly, and focused on archetype selection
    - Handle basic response patterns (names, numbers, simple descriptions)
- **Scope:** Core functionality only - advanced features (express mode, persistence, voice-ready) handled in separate stories

## Story Progress Notes

### Agent Model Used: `<To be filled by Dev Agent>`

### Completion Notes List

{To be filled by Dev Agent}

### Change Log

| Change                                    | Date       | Version | Description                                     | Author     |
| :---------------------------------------- | :--------- | :------ | :---------------------------------------------- | :--------- |
| Formalized by PO                          | 2025-05-31 | 0.1     | Initial formalization                           | Sarah (PO) |
| Prepared for Dev by SM                    | 2025-06-01 | 1.0     | Added detailed tasks, v0.io step, tech guidance | Bob (SM)   |
| Conversational Enhancement Update         | 2025-01-27 | 2.0     | Rewritten for conversational chat interface approach | Curly (PO) |