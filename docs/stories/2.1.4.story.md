# Story 2.1.4: Enhanced Interactive Onboarding Experience

## Status: Approved

## Epic: 2 - AI Copilot Onboarding & Personalization Foundation MVP

## Story

- As a new user undergoing AI Copilot onboarding, I want an enhanced interactive experience with markdown-rendered messages, personalized welcome from "Jake" the AI agent, and visual archetype selection using interactive components so that the onboarding feels more engaging and professional.

## Dependencies

- **Prerequisite:** Story 2.1 (Core Conversational Archetype Selection) must be completed
- **Enhancement:** Builds upon existing conversational foundation with UI/UX improvements

## Acceptance Criteria (ACs)

1. **Personalized Welcome Enhancement**: When onboarding begins, the AI introduces itself as "Jake" and uses the user's name from their profile in the greeting (e.g., "Hi [UserName]! I'm Jake, your AI Copilot...")
2. **Markdown Rendering Support**: The chat interface renders markdown formatting in AI messages, including bold text, lists, and other basic markdown elements
3. **Component Container Capability**: The chat message system supports rendering React components within messages, not just text content
4. **Interactive Archetype Selection**: When presenting archetypes, Jake displays the existing `ArchetypeCard.tsx` components in an interactive grid instead of text descriptions
5. **Visual Archetype Interaction**: Users can click directly on archetype cards to make their selection, with visual feedback (selection state, hover effects)
6. **Seamless Integration**: The enhanced interface maintains all existing functionality from Story 2.1 (natural language processing, error handling, API persistence)
7. **Responsive Design**: The interactive archetype selection works properly on both desktop and mobile devices
8. **Graceful Fallback**: If component rendering fails, the system falls back to the original text-based conversation flow
9. **Conversation Continuity**: After archetype selection via components, the conversation continues naturally with Jake's personalized confirmation
10. **Performance Optimization**: The enhanced interface maintains smooth performance without impacting chat responsiveness

## Tasks / Subtasks

- [ ] **Task 1: Chat Message Enhancement Infrastructure**
    - [ ] Extend `ChatMessageBubble.tsx` to support markdown rendering using a library like `react-markdown`
    - [ ] Implement component container system for rendering React components within chat messages
    - [ ] Create new message types to distinguish between text, markdown, and component messages

- [ ] **Task 2: Personalized Welcome Implementation**
    - [ ] Update conversation scripts in `archetype-onboarding.ts` to include "Jake" as the agent name
    - [ ] Integrate user name retrieval from auth store/user profile
    - [ ] Enhance greeting message to be personalized and welcoming

- [ ] **Task 3: Interactive Archetype Selection System**
    - [ ] Create archetype selection component that renders existing `ArchetypeCard.tsx` components
    - [ ] Implement archetype data integration with existing archetype definitions
    - [ ] Add selection state management and visual feedback for card interactions

- [ ] **Task 4: Component Message Integration**
    - [ ] Extend conversation manager to support component-based messages
    - [ ] Create archetype selection message type that renders the interactive component
    - [ ] Implement component-to-conversation communication for selection handling

- [ ] **Task 5: Enhanced Conversation Flow**
    - [ ] Update conversation manager to trigger component rendering at appropriate times
    - [ ] Implement seamless transition from component selection back to text conversation
    - [ ] Ensure proper state management between component and text interactions

- [ ] **Task 6: Responsive Design & Mobile Support**
    - [ ] Ensure archetype card grid works properly on mobile devices
    - [ ] Implement responsive layout for component messages
    - [ ] Test and optimize touch interactions for mobile archetype selection

- [ ] **Task 7: Error Handling & Fallback System**
    - [ ] Implement graceful fallback to text-based selection if component rendering fails
    - [ ] Add error boundaries around component messages
    - [ ] Create fallback conversation paths for component interaction failures

- [ ] **Task 8: Performance Optimization**
    - [ ] Optimize markdown rendering performance
    - [ ] Implement efficient component message rendering
    - [ ] Ensure chat interface remains responsive with enhanced features

- [ ] **Task 9: Testing**
    - [ ] Write unit tests for markdown rendering and component message system
    - [ ] Write integration tests for interactive archetype selection flow
    - [ ] Write E2E tests for complete enhanced onboarding experience

- [ ] **Task 10: Build and Test Validation**
    - [ ] Build completed successfully with no errors
    - [ ] All tests passing including enhanced interface functionality
    - [ ] Performance benchmarks met for enhanced chat interface

- [ ] **Task 11: Story Completion**
    - [ ] All acceptance criteria met and validated
    - [ ] Enhanced interactive onboarding experience fully functional
    - [ ] Story marked as Complete following BMAD methodology

## Dev Technical Guidance

- **Frontend:**
    - Use `react-markdown` or similar library for markdown rendering in chat messages
    - Leverage existing `ArchetypeCard.tsx` components without modification
    - Implement component message system that can render any React component within chat
    - Maintain existing conversation state management and API integration
- **Component Integration:**
    - Create a flexible system for embedding React components in chat messages
    - Use existing archetype data structures and icons from the codebase
    - Ensure component interactions properly communicate with conversation manager
- **User Experience:**
    - Keep Jake's personality friendly and helpful, consistent with existing conversation tone
    - Ensure smooth transitions between component interactions and text conversation
    - Maintain accessibility standards for interactive elements
- **Performance:**
    - Lazy load markdown rendering library if needed
    - Optimize component rendering to avoid chat interface lag
    - Consider virtualization for large conversation histories with components
- **Integration:** Seamless enhancement of Story 2.1 foundation without breaking existing functionality

## Story Progress Notes

### Agent Model Used: `<To be filled by Dev Agent>`

### Completion Notes List

{To be filled by Dev Agent}

### Change Log

| Change                    | Date       | Version | Description                                    | Author     |
| :------------------------ | :--------- | :------ | :---------------------------------------------- | :--------- |
| Created Enhanced Onboarding Story | 2025-01-27 | 1.0   | Created interactive onboarding enhancement story | BMAD Orchestrator |
